<!doctype html>
<head>
  <meta charset="utf-8">

  <title>My Parse App</title>
  <meta name="description" content="My Parse App">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <script type="text/javascript" src="jquery.min.js"></script>
  <script type="text/javascript" src="parse-1.2.12.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript">
  Parse.initialize("3tHHUyxjtuSEiHranjliYJkJ36fEO89Ql77L2jng", "nY2YCI6Jn6ikyBWrjOxf3zj5bc8aPL5gvIUgGC5C");
</script>
</head>

<body>
  <header class="page-title container">
  <div class>
    <h1 class="span6">LeaderBoard</h1>
  </div>
  </header>

  <script type="text/javascript">
	function getLeaders(length) {
    var User = Parse.Object.extend("User");
    var userQuery = new Parse.Query(User);
    var Pictures = Parse.Object.extend("Pictures");
    var picQuery = new Parse.Query(Pictures);
	picQuery.equalTo("owner",objectId);
	picQuery.find({
      success: function(pics) {
	    var ratings = {};
	    for (var j=0; j<pics.length; j++) {
	      var pic = pics[j];
	  	  ratings{pic.get(owner)} += pics.get(rating)/pic.get(totalViews);
	    }
		var sorted = [];
		for (var key in ratings) {
		sorted.push({'username':userQuery.get('objectId',key).get('username'),'value':ratings[key]});
		}
		sorted.sort(function(a,b) { return a.value-b.value;});
		return sorted.slice(0,length);
	  },
      error: function() {
	  }
	});
	}
  function dispLeaders() {
	var leaders = getLeaders(5);
  }

  </script>
</body>

</html>
